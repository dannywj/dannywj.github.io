---
title: 设计模式那点事儿——建造者模式
tags: [develop,设计模式]
date: 2016-07-29 14:26:01
---
无意中看到了一个网站：[图说设计模式](http://design-patterns.readthedocs.io/zh_CN/latest/index.html)，里面讲解了一些常用设计模式的定义，模式分析，优缺点，示例代码，适用场景等，写的不错，自己也按照这个思路，对这些设计模式进行了思考和尝试，本次尝试了其中的`建造者模式`

# 定义
建造者模式是一步一步创建一个复杂的对象，它允许用户只通过指定复杂对象的类型和内容就可以构建它们，用户不需要知道内部的具体构建细节。建造者模式属于对象创建型模式。根据中文翻译的不同，建造者模式又可以称为生成器模式。

# 实例解析
**实例：KFC套餐**

建造者模式可以用于描述KFC如何创建套餐：套餐是一个复杂对象，它一般包含主食（如汉堡、鸡肉卷等）和饮料（如果汁、 可乐等）等组成部分，不同的套餐有不同的组成部分，而KFC的服务员可以根据顾客的要求，一步一步装配这些组成部分，构造一份完整的套餐，然后返回给顾客。

# 模式类图
![KFC示例](https://raw.githubusercontent.com/dannywj/dannywj.github.io/raw/raw/source/statics/KFCBuilder.jpg)

# 实现代码
## 指挥者类
```php
<?php

/**
 * 指挥者类
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
class KFCWaiter {
    // 建造过程固定不变
    public function setMealBuilder(MealBuilder $builder) {
        $builder->BuildDrink();// 过程1
        $builder->BuildFood();// 过程2
    }
}
```

## 抽象建造者类
```php
<?php

/**
 * 抽象建造者类
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
abstract class MealBuilder {
    abstract function BuildDrink();

    abstract function BuildFood();

    abstract function getMeal();
}
```

## 具体建造者类A
```php
<?php

/**
 * 具体建造者类A
 * 实现抽象建造者类
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
class SubMealBuilderA extends MealBuilder {
    private $meal;

    public function __construct() {
        $this->meal = new Meal();//具体建造的产品对象
    }

    function BuildDrink() {
        $this->meal->setDrink('build drink A');
    }

    function BuildFood() {
        $this->meal->setFood('build food A');
    }

    function getMeal() {
        return $this->meal->getDrink() . '+++' . $this->meal->getFood();
    }

}
```

## 具体建造者类B
```php
<?php

/**
 * 具体建造者类B
 * 实现抽象建造者类
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
class SubMealBuilderB extends MealBuilder {
    private $meal;

    public function __construct() {
        $this->meal = new Meal();
    }

    function BuildDrink() {
        $this->meal->setDrink('build drink B');
    }

    function BuildFood() {
        $this->meal->setFood('build food B');
    }

    function getMeal() {
        return $this->meal->getDrink() . '+++' . $this->meal->getFood();
    }
}
```

## 产品类
```php
<?php

/**
 * 产品类
 * 具体建造的对象类
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
class Meal {
    private $food;
    private $drink;

    /**
     * @return mixed
     */
    public function getFood() {
        return $this->food;
    }

    /**
     * @param mixed $food
     */
    public function setFood($food) {
        $this->food = $food;
    }

    /**
     * @return mixed
     */
    public function getDrink() {
        return $this->drink;
    }

    /**
     * @param mixed $drink
     */
    public function setDrink($drink) {
        $this->drink = $drink;
    }
}
```

## 调用客户端
```php
<?php
/**
 * 入口
 * Created by DannyWang
 * wangjue@mia.com
 * 2016/7/28
 */
require_once(__DIR__ . '/KFCWaiter.php');
require_once(__DIR__ . '/Meal.php');
require_once(__DIR__ . '/MealBuilder.php');
require_once(__DIR__ . '/SubMealBuilderA.php');
require_once(__DIR__ . '/SubMealBuilderB.php');

// 指挥者
$waiter = new KFCWaiter();
// 建造者A
$builderA = new SubMealBuilderA();
$waiter->setMealBuilder($builderA);
$foo1 = $builderA->getMeal();
// 建造者B
$builderB = new SubMealBuilderB();
$waiter->setMealBuilder($builderB);
$foo2 = $builderB->getMeal();

var_dump($foo1, $foo2);
```

## 结果输出
```
E:\DannyCode\study\Builder\client.php:25:string 'build drink A+++build food A' (length=28)
E:\DannyCode\study\Builder\client.php:25:string 'build drink B+++build food B' (length=28)
```

# 参考链接
[建造者模式](http://design-patterns.readthedocs.io/zh_CN/latest/creational_patterns/builder.html)