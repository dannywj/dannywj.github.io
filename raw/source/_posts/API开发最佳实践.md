layout: w
title: API开发最佳实践
date: 2016-04-05 11:55:04
tags: [develop,architecture&design]
---
# 业务逻辑部分
## 业务分层优化
明确各个层的任务：
Model(DAO):数据持久层的工作，对数据库的操作都封装在这。
Service ： 业务逻辑层，负责业务模块的逻辑应用设计，controller中就可以调用service的接口实现业务逻辑处理，提高了通用的业务逻辑的复用性，设计到具体业务实现会调用Model的接口。
Controller ：控制层，负责具体业务流程控制，这里调用service层，将数据返回到视图

## 业务设计
1. 排序是很重要的，添加排序字段，获取的时候要强制排序规则。
2. array_values方法可以使数组以0-n的索引重新排列数组的值，便于客户端处理（相当于带编号）。`$data = array_values($data);`


# 代码细节部分
1. mc的键值各个业务模块应该区分，且带上必要的渠道参数，方便管理。

1. 判断尽量简洁，配置文件可以采用键值对的形式进行配置，判断使用isset方式。

1. 本地redis清除缓存方式：flushall：删除所有数据库中的所有key

1. mysql在一次查询大量数据的时候，为避免内存占满，可以采用增加`mysql_use_result`的方式来逐条处理（其中不能有更新操作） 参考链接：https://www.percona.com/blog/2006/06/26/handling-of-big-parts-of-data/

1. 配置文件及返回的处理
1.配置文件的两种方式：
a.按层级进行配置，如：分类->项目->地址。
b.按key直接查找。key的命名显示出层级。
2.返回客户端如果是是否显示+值的形式，可以简化为只加一个字段。有该字段为显示，且使用该值。没有该字段为隐藏。（前提是只有一个值的情况，有多个值的情况无法进行扩展）

# 流程规范部分
1.feature分支要基于master分支开出，为的是保证新开发的分分支是基于稳定的。（错误案例是从release分支开出）
2.每个分支只做一件事情
3.冲突最理想的情况是在发生冲突前用一些手段规避和扼杀掉。如：公共的需要修改的方法，可以考虑再开出一个新分支来处理（抽象），解决公共的功能。也就是说的解耦，让程序模块化，彼此的依赖降低到最低。
思想：如何长远的采用非人工的，优雅的方式解决问题。
P.S. 来自于一次不符合规范的提交分享会

# 应急及性能提升部分
1. 流量大时可将次要接口（如收藏/购物车商品数量在进入时候的显示）降级处理。接口直接返回空数据或者人造数据，防止查询数据库造成对系统的影响。
2. 次要逻辑及频繁读写DB的操作可以通过消息队列异步处理，防止高峰时刻挂掉。

# 注意事项
1. 流程中如有回调/异步的情况出现，流程的执行顺序就不能保证了！