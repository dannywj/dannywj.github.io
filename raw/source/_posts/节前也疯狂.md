---
title: 节前也疯狂
tags: [develop,DHB]
date: 2016-01-27 16:37:57
---

# 思想层面
1. 适当的简化流程，如果需要复杂流程，则需要双方进行对应功能的开发，时间的增加，流程复杂度的增加。如：无账号系统向有账号系统的转换，订单的迁移和同步。

1. 把产品需求分析透彻，工作量和开发难点，方便实现的，对接难以控制时间的。

1. 技术方案制定后，需要让产品和对方协商，根据工期进行功能的取舍。

1. 需要第三方对接的，时间预期要宽松，留出联调时间。

1. 第三方组件在上线前不能及时提供的，需要考虑上线使用的风险。如JS接口。

1. 任务紧急，人力资源紧张，可以尝试简化需求，分批操作上线。

1. 由于时间紧迫以及难以由程序自动实现的，或者依赖第三方服务且不能保证稳定性的，可以考虑人工系统补救的方案，保证服务的稳定性。

1. 发短信/邮件/数据推送等通知其他方面的情况，要保证主流程不中断。不能在发送过程中报错，抛异常或终止程序。

1. 服务接入要提前封装，使用interface方式更灵活。保证备选CP及接口的方便切换。且接口实现类行为单一，不要设计业务逻辑的处理，要统一流程。

1. 回调的防重机制。第三方回调（支付成功/第三方业务处理成功）后，要及时修改订单状态，并在接收回调时验证订单状态，阻止重复处理请求。

1. 产品上线前和客户确认，防止上线后再调整细节。

1. 订单推送等于主业务不相干的功能可以往后放（开发/上线）。

1. 简易的应急方案，防止机房故障服务不可用。另外部署到其他机器上，不使用数据库（文本记录，统一人工处理）。


# 技术层面

1. 设备标识可以用cookie模拟，创建默认账号，第三方提供不了的情况下可以灵活实现。

2. cookie也可以近似用于统计用户量来使用。

1. 入口页只做初始化操作，实现逻辑左include中进行

1. 接口对接超时设置。不需要依赖返回值的接口可以设置1s的超时时间（不等待结果反馈）

1. 回调地址尽量按照不带参数的处理。一些第三方是会限制的。可以考虑单独生成不同入口的方式。

1. log等需要写入数据库字段的值（不可预期的值，如sql），插入前一定要转义。`$info = addslashes($info)` 

1. curl调用第三方接口的时候，有可能会产生调用超时而实际请求成功的情况出现。因此要考虑到这一点带来的风险。（逻辑上可以特殊处理这部分超时的情况）

1. 服务端log查看：
```
cat yulorepagesLog.log | grep "sa update affected rows"  --搜索指定字符
cat yulorepagesLog.log | grep -A30 "sa update affected rows"   --搜索指定字符的后xx行
cat yulorepagesLog.log | grep -B30 "sa update affected rows"   --搜索指定字符的前xx行
```

