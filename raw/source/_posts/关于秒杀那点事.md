---
title: 关于秒杀那点事
tags: [develop,work]
date: 2017-03-31 17:56:17
---
# 思想与感受

## 关于缓存
缓存是针对性能优化的一种技术手段，主要是防止服务端压力过大。缓存的添加可以提前考虑，也可以先不添加，观察一段运行中的反应再进行适当添加。
对于秒杀，实时性要求比较高，可以暂时不加缓存。大促进行中的高峰期可适当设置1-2分钟的缓存时间。

## 售卖进度条
进度条可以采用固定公式计算，不可使用随机数（以免不同端的数据生成不一致），可以使用id%xx取模生成。如果想动态变化，需要在公式里关联进去时间因子，已售数目因子等。
多端数据也可以统一存入redis，由一方控制数据源。

## 分页+排序
需要排序原则上无法进行分页显示。折衷的做法是，与客户端先约定好分页的参数，实际获取的时候按一页数据获取，未来数据量大，修改成真正分页模式获取，客户端不需要升级。

## 秒杀实时性
不依赖客户端时间，以服务端时间为准。
时间改变的接口设计，动态返回秒数，以服务端时间为准，并返回给客户端xx秒后强制刷新。

## 涉及“钱”的兑换接口
需要钱或等价虚拟货币兑换的api，如果有类似的兑换接口，则此接口需要进行服务端参数验证，防止非法用户拿到兑换批次后直接调用其它入口兑换。


# 代码怎么写
## 代码结构设计
```
├─application
│  ├─config
│  │  └─seckill_config.php                   秒杀配置文件
│  ├─controller
│  │  ├─android
│  │  │  └─seckill.php                       安卓控制器
│  │  └─ios
│  │     └─seckill.php                       IOS控制器
│  ├─library
│  │  └─seckill                              秒杀核心类库
│  │     ├─Business.php                      秒杀业务逻辑处理类
│  │     ├─SalePercent.php                   秒杀进度
│  │     └─SeckillItem.php                   秒杀商品类
│  └─models
│     └─seckill_model.php                    数据访问层model

```

